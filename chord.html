<!DOCTYPE html>
<meta charset="utf-8">
<script src="js/d3.min.js"></script>
<style>

.chord path {
  fill-opacity: .67;
  stroke: #000;
  stroke-width: .5px;
}

</style>
<body>
  
<script>

var matrix = [];
var numberofuniquerests = 5   //THIS IS HARD CODED
var colors = []

//LOADING CSV FILE OF DATA
d3.csv("http://localhost:8088/data.csv", function(data) {
  
  length = numberofuniquerests
  
  //INITITALIZING VALUES IN MATRIX AS ZERO
  for(i=0;i<length;i++)
  {
    matrix[i] = []
    for(j=0;j<length;j++)
    {
      matrix[i][j] = 0
    }
  }
  
  //GENERATE COLORS RANDOMLY
  for(j=0;j<length;j++)
  {
     colors[j] = '#'+(0x1000000+(Math.random())*0xffffff).toString(16).substr(1,6)
  }

  //FILLING VALUES INTO THE MATRIX
  for(obj in data)
  {
    indexrest1 = parseInt(data[obj].restaurant1)
    indexrest2 = parseInt(data[obj].restaurant2)
    console.log(data[obj].count)
    matrix[indexrest1-1][indexrest2-1] = parseInt(data[obj].count)
  }

  //STARTING VISUALIZATION

    //INITIALIZING CHORD
  var chord = d3.layout.chord()
    .padding(.05)
    .sortSubgroups(d3.descending)
    .matrix(matrix);

    //INITIALIZING VARIABLES
  var width = 960,
      height = 500,
      innerRadius = Math.min(width, height) * .41,
      outerRadius = innerRadius * 1.1;

  var fill = d3.scale.ordinal()
      .domain(d3.range(4))
      .range(colors)

  var svg = d3.select("body").append("svg")
      .attr("width", width)
      .attr("height", height)
    .append("g")
      .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

      //APPENDING TO VISUALIZATION
      debugger;
  svg.append("g").selectAll("path")
      .data(chord.groups)
    .enter().append("path")
      .style("fill", function(d) { return fill(d.index); })
      .style("stroke", function(d) { return fill(d.index); })
      .attr("d", d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius))
      .on("mouseover", fade(.1))
      .on("mouseout", fade(1))
      ////////////////////////////////////////////////
      ///////////THIS PART IS TO BE FIXED/////////////
      ////////////////////////////////////////////////
      .append("svg:text")
        .attr("x", 6)
        .attr("dy", 15)
        .filter(function(d) { return d.value > 110; })
      .append("svg:textPath")
        .attr("xlink:href", function(d) { return "#group" + d.index + "-" + j; })
        .text(function(d) { return matrix[d.index].toString(); 
      });
        ///////////////////////////////////////////////


  svg.append("g")
      .attr("class", "chord")
    .selectAll("path")
      .data(chord.chords)
    .enter().append("path")
      .attr("d", d3.svg.chord().radius(innerRadius))
      .style("fill", function(d) { return fill(d.target.index); })
      .style("opacity", 1)

      
  // FADING OTHER VALUES ON MOUSEOVER
  function fade(opacity) {
    return function(g, i) {
      svg.selectAll(".chord path")
          .filter(function(d) { return d.source.index != i && d.target.index != i; })
        .transition()
          .style("opacity", opacity);
    };
  }
});
</script>